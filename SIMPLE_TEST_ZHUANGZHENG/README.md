# 图像方向自动校正系统

## 功能描述
基于尖端检测的图像方向自动校正系统，专门用于处理箭头/三角形标识图像的方向校正。

## 核心特性
- **智能预处理**: 灰度化、去噪、二值化、形态学操作
- **精确尖端检测**: 基于轮廓分析和凸包算法
- **自动角度计算**: 几何方法计算旋转角度
- **批量处理**: 支持批量处理多个图像文件
- **调试模式**: 保存中间处理步骤的图像
- **详细报告**: 生成处理结果报告

## 安装依赖

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. 快速测试
运行测试脚本处理ORIGINAL_PICS目录中的示例图像：

```bash
python test_correction.py
```

### 2. 命令行使用
```bash
python image_orientation_corrector.py -i 输入目录 -o 输出目录 [-d]
```

参数说明：
- `-i, --input`: 输入图像目录
- `-o, --output`: 输出目录
- `-d, --debug`: 开启调试模式（可选）

### 3. 编程接口使用
```python
from image_orientation_corrector import ImageOrientationCorrector

# 创建校正器
corrector = ImageOrientationCorrector(debug_mode=True)

# 处理单张图像
import cv2
image = cv2.imread('input.png')
corrected_image, info = corrector.correct_orientation(image)

# 保存结果
cv2.imwrite('output.png', corrected_image)
print(f"旋转角度: {info['rotation_angle']:.2f}度")
```

## 算法原理

### 1. 预处理流程
1. **灰度转换**: 彩色图像转为灰度图像
2. **高斯滤波**: 去除图像噪声
3. **对比度增强**: CLAHE自适应直方图均衡化
4. **二值化**: OTSU自适应阈值
5. **形态学操作**: 开运算去噪点，闭运算填孔洞

### 2. 尖端检测算法
1. **轮廓提取**: 找到最大轮廓作为主要形状
2. **质心计算**: 计算轮廓的几何中心
3. **尖端识别**: 找到距离质心最远的点
4. **凸包验证**: 使用凸包算法验证尖端点

### 3. 角度计算与旋转
1. **向量计算**: 计算从图像中心到尖端的向量
2. **角度计算**: 计算与垂直方向的夹角
3. **图像旋转**: 使用仿射变换旋转图像

## 输出结果

处理完成后会生成以下文件：
- `corrected_*.png`: 校正后的图像
- `debug/`: 调试图像目录（开启调试模式时）
  - `*_gray.png`: 灰度图像
  - `*_thresh.png`: 二值化图像
  - `*_contour.png`: 轮廓图像
  - `*_tip_detection.png`: 尖端检测图像
- `processing_report.txt`: 详细处理报告

## 技术参数

- **支持格式**: PNG, JPG, JPEG, BMP, TIFF
- **最小轮廓面积**: 100像素
- **角度精度**: 0.01度
- **处理速度**: 约1-2秒/图像（取决于图像大小）

## 注意事项

1. **图像质量**: 确保输入图像对比度良好，箭头形状清晰
2. **背景要求**: 建议使用单色背景，避免复杂纹理
3. **形状要求**: 适用于三角形、箭头等具有明显尖端的形状
4. **尺寸限制**: 建议图像尺寸不超过2000x2000像素

## 故障排除

### 常见问题
1. **未找到轮廓**: 检查图像对比度，调整预处理参数
2. **尖端检测失败**: 确保形状具有明显的尖端特征
3. **角度计算错误**: 检查图像中心和尖端点的位置

### 调试建议
1. 开启调试模式查看中间处理结果
2. 检查二值化效果是否良好
3. 确认轮廓提取是否正确
4. 验证尖端点检测是否准确

## 版本信息
- 版本: 1.0.0
- 作者: AI Assistant
- 更新日期: 2024 